{template 'common/header'}
<style type="text/css">
	.tag{
		border:1px solid #e3e3e3;
		padding:5px 10px;
		position: relative;
		border-radius: 5px;
		margin:0px 20px 5px 10px;
		line-height: 40px;
	}
	.tag i{
		position: absolute;
		top:-5px;
		right:-5px;
		font-size:16px;
		color: #427bf6;
		cursor: pointer;
	}
</style>
<div class="main">
	<table class="table">
		<thead>
			<tr>
				<th>内容</th>
				<th width="30%">标签</th>
				<th width="15%">操作</th>
			</tr>
		</thead>
		<tbody>
			{loop $list $index $item}
			<tr>
				<td>
					<input type="text" style="display:none" class="edit-input form-control" value="{$item['content']}"/>
					<span class="edit-text">{$item['content']}</span>
				</td>
				<td>
					<div class="tag-list">
					{loop $item['tag'] $index $tag}
					<span class="tag">
						<i class="fa fa-times-circle" data-id="{$tag['id']}"></i>
						{$tag['name']}
					</span>
					{/loop}
					</div>
				</td>
				<td>
					<input type="button" class="btn btn-primary edit" value="编辑" data-id="{$item['id']}"/>
					<input type="button" class="btn btn-primary save" value="保存" style="display: none" data-id="{$item['id']}"/>
					<input type="button" class="btn btn-primary delete" value="删除" data-id="{$item['id']}"/>
				</td>
			</tr>
			{/loop}
		</tbody>
	</table>
	{php echo pagination(20, 1, 1);}
</div>

<script>
require(['jquery', 'util'], function($, util){
	$(function(){
		$('.table').on('click','.delete',function(){
			var id = $(this).data('id');
			fetch('{php echo $this->createWebUrl("deleteContent");}',{id:id});
		})
		$('.table').on('click','.edit',function(){
			var $this = $(this).closest('tr');
			$(this).hide();
			$this.find('.edit-input').show();
			$this.find('.edit-text').hide();
			$(this).closest('td').find('.save').show();
		})
		$('.table').on('click','.save',function(){
			var id = $(this).data('id');
			var $this = $(this).closest('tr');
			$this.find('.edit').show();
			$this.find('.save').hide();
			$this.find('.edit-input').hide();
			$this.find('.edit-text').text($this.find('.edit-input').val()).show();

			fetch('{php echo $this->createWebUrl("updateContent");}',{id:id});
		})
		function fetch(url,data){
			$.ajax({
				url:url,
				data:data,
				type:'post',
				dataType:'json'
			}).done(function(data){
				if(data.code === 1){
					util.message(data.msg);
					setTimeout(function(){
						location.reload();
					},1000)
				}else{
					util.message(data.msg);
				}
			})
		}
	});
});
</script>

{template 'common/footer'}